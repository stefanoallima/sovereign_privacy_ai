[target.x86_64-pc-windows-msvc]
# Mixed CRT situation:
#   llama-cpp-sys-2 → MD_DynamicRelease (dynamic CRT, /MD)
#   esaxx-rs (via tokenizers via gline-rs) → MT_StaticRelease (static CRT, /MT)
#     even with the [patch.crates-io] setting static_crt(false), the pragma
#     comment(linker, "/NODEFAULTLIB:msvcrt.lib") is still embedded in the .obj.
#
# Strategy: exclude libcmt (static CRT) via /NODEFAULTLIB, then force-include
#   msvcrt.lib as a *direct* link input (bypasses /NODEFAULTLIB:msvcrt.lib pragma).
#   Direct library inputs are always searched regardless of /NODEFAULTLIB flags.
rustflags = [
    # Exclude static CRT default libs (pragma-injected by esaxx-rs /MT objects)
    "-C", "link-arg=/NODEFAULTLIB:LIBCMT",
    "-C", "link-arg=/NODEFAULTLIB:LIBCMTD",
    "-C", "link-arg=/NODEFAULTLIB:libcpmt.lib",
    "-C", "link-arg=/NODEFAULTLIB:libcpmtd.lib",
    # Force dynamic CRT as a direct input — bypasses the /NODEFAULTLIB:msvcrt.lib
    # pragma embedded in /MT-compiled esaxx-rs objects, ensuring __chkstk resolves.
    "-C", "link-arg=msvcrt.lib",
    "-C", "link-arg=vcruntime.lib",
    "-C", "link-arg=ucrt.lib",
]
