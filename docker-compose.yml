services:
  livekit:
    image: livekit/livekit-server:latest
    command: --dev --bind 0.0.0.0
    ports:
      - "7880:7880"   # HTTP/WebSocket
      - "7881:7881"   # RTC (UDP)
      - "7882:7882"   # RTC (TCP)
    environment:
      LIVEKIT_KEYS: "devkey: secret"
    networks:
      - voice-network

  voice-agent:
    build: ./apps/voice-agent
    depends_on:
      - livekit
    environment:
      LIVEKIT_URL: ws://livekit:7880
      LIVEKIT_API_KEY: devkey
      LIVEKIT_API_SECRET: secret
      NEBIUS_API_KEY: ${NEBIUS_API_KEY}
      # Use CPU for Whisper (comment out for GPU)
      WHISPER_DEVICE: cpu
    volumes:
      - ./models:/app/models  # Shared model cache
    networks:
      - voice-network
    # Uncomment below to enable GPU support (requires NVIDIA Container Toolkit)
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]

networks:
  voice-network:
    driver: bridge
